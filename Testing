--// Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

--// Globals
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local HRP = LocalPlayer.Character and LocalPlayer.Character:WaitForChild("HumanoidRootPart")

-- GUI VARIABLES
local guiOverlay, loadingBar
local totalPhases = 3
local currentPhase = 0

-- GUI CREATION
local function createProcessOverlay()
    if not LocalPlayer.Character then LocalPlayer.CharacterAdded:Wait() end
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")

    guiOverlay = Instance.new("ScreenGui")
    guiOverlay.Name = "MoneyDupeOverlay"
    guiOverlay.IgnoreGuiInset = true
    guiOverlay.ResetOnSpawn = false
    guiOverlay.ZIndexBehavior = Enum.ZIndexBehavior.Global
    guiOverlay.Parent = playerGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
    frame.BackgroundTransparency = 0.1
    frame.BorderSizePixel = 0
    frame.ZIndex = 8
    frame.Parent = guiOverlay

    local topLabel = Instance.new("TextLabel")
    topLabel.Size = UDim2.new(1, 0, 0.08, 0)
    topLabel.Position = UDim2.new(0, 0, 0.02, 0)
    topLabel.Text = "BIGBACK/JFP ;)"
    topLabel.Font = Enum.Font.FredokaOne
    topLabel.TextSize = 30
    topLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    topLabel.BackgroundTransparency = 1
    topLabel.ZIndex = 11
    topLabel.Parent = frame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0.1, 0)
    label.Position = UDim2.new(0, 0, 0.4, 0)
    label.Text = "Money Dupe Loading. / wash cash after"
    label.Font = Enum.Font.GothamBold
    label.TextSize = 32
    label.TextColor3 = Color3.new(1, 1, 1)
    label.BackgroundTransparency = 1
    label.TextStrokeTransparency = 0.8
    label.ZIndex = 10
    label.Parent = frame

    local loadingBarBG = Instance.new("Frame")
    loadingBarBG.Size = UDim2.new(0.6, 0, 0.05, 0)
    loadingBarBG.Position = UDim2.new(0.2, 0, 0.52, 0)
    loadingBarBG.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    loadingBarBG.BorderSizePixel = 0
    loadingBarBG.ZIndex = 9
    loadingBarBG.Parent = frame

    loadingBar = Instance.new("Frame")
    loadingBar.Size = UDim2.new(0, 0, 1, 0)
    loadingBar.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
    loadingBar.BorderSizePixel = 0
    loadingBar.ZIndex = 10
    loadingBar.Parent = loadingBarBG
end

local function advanceProgress()
    currentPhase += 1
    local progress = math.clamp(currentPhase / totalPhases, 0, 1)
    if loadingBar then
        loadingBar:TweenSize(UDim2.new(progress, 0, 1, 0), "Out", "Sine", 0.5, true)
    end
end

local function destroyOverlay()
    if guiOverlay then
        guiOverlay:Destroy()
        guiOverlay = nil
    end
end

local AUTO_LOOP_DELAY = 0.25
local RANGE = 10
local pitcherCupFilled = false

local cookingTargetNames = {
    ["CookPart"] = true, ["CookingPart"] = true, ["CookingPot"] = true, ["CookingPots"] = true,
    ["Stove"] = true, ["Oven"] = true
}
local specialPromptNames = {
    ["Mix Items"] = true, ["Turn On"] = true, ["Fill Cup"] = true, ["Fill Pitcher Cup"] = true
}

local function getRoot()
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    return character:WaitForChild("HumanoidRootPart")
end

local function isNear(part, range)
    local root = getRoot()
    return part and (part.Position - root.Position).Magnitude <= range
end

local function tryFirePrompt(prompt, tag, callback)
    if not prompt:IsA("ProximityPrompt") or not prompt.Enabled then return end
    pcall(function()
        fireproximityprompt(prompt, 0)
    end)
    print(">> [" .. (tag or "Prompt") .. "] Fired at:", prompt:GetFullName())

    if tag == "Fill Pitcher Cup" and not pitcherCupFilled then
        pitcherCupFilled = true
        print(">> Pitcher Cup filled via prompt. Triggering duplication.")
        if typeof(callback) == "function" then callback() end
    end
end

local function safeTeleport(cf)
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid and humanoid.SeatPart then
        humanoid.Sit = false
        task.wait(0.2)
    end
    HRP.CFrame = cf + Vector3.new(0, 3, 0)
end
